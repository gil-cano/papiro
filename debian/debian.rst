======
Debian
======

Mostrar la versión de Linux

.. code-block:: shell

    $ lsb_release -a

Mostrar la versión del kernel

.. code-block:: shell

    $ uname -r


Actualizar

.. code-block:: shell

    $ sudo apt-get update
    $ sudo apt-get upgrade

Mostrar versiones disponibles de un paquete
-------------------------------------------

.. code-block:: shell

    $ apt-cache policy haproxy
    haproxy:
      Installed: 1.5.14-1~bpo8+1
      Candidate: 1.6.5-1~bpo8+1
      Version table:
         1.6.5-1~bpo8+1 0
            100 http://http.debian.net/debian/ jessie-backports/main amd64 Packages
     *** 1.5.14-1~bpo8+1 0
            100 /var/lib/dpkg/status
         1.5.8-3+deb8u2 0
            500 http://mmc.geofisica.unam.mx/debian/ jessie/main amd64 Packages
         1.5.8-3+deb8u1 0
            500 http://security.debian.org/ jessie/updates/main amd64 Packages


Procesos muertos
----------------

.. code-block:: shell

    $ ps -ef | grep defunct


Cron
----

La sintaxis es:

.. code-block:: shell

    1 2 3 4 5 /path/to/command arg1 arg2

Donde

.. code-block:: shell

    * * * * * command to be executed
    - - - - -
    | | | | |
    | | | | ----- Día de la semana (0 - 7) (Domingo=0 or 7)
    | | | ------- Mes (1 - 12)
    | | --------- Día del mes (1 - 31)
    | ----------- Hora (0 - 23)
    ------------- Minuto (0 - 59)

Los archivos del cron viven en: /var/spool/cron/crontabs, se be editar con contrab

Para gregar un trabajo como root

.. code-block:: shell

    $ sudo crontab -e


.. code-block:: shell

    # Generated by gilo
    2 12 * * 5 /path/to/plone/bin/client9 -O infomatem run /path/to/plone/src-git/matem.event/src/matem/event/sbin/test.py
    # END


Listar o borrar los trabajos crontab

.. code-block:: shell

    $ crontab -l
    $ sudo crontab -u plone -l
    $ sudo crontab -r


Seguridad SSH
-------------

Instalacion y estado de ssh

.. code-block:: shell

    $ sudo apt-get install openssh-server
    $ sudo service ssh status
    ● ssh.service - OpenBSD Secure Shell server
       Loaded: loaded (/lib/systemd/system/ssh.service; enabled)
       Active: active (running) since Mon 2018-07-23 10:22:44 EDT; 3 weeks 3 days ago
     Main PID: 909 (sshd)
       CGroup: /system.slice/ssh.service
               └─909 /usr/sbin/sshd -D

Para detener, remover del inicio, inicar atumaticamente e iniciar el servicio

.. code-block:: shell

    $ sudo systemctl stop ssh
    $ sudo systemctl disable ssh
    $ sudo systemctl enable ssh
    $ sudo systemctl start ssh

El archivo de configuración es:

.. code-block:: shell

    /etc/ssh/sshd_config


.. code-block:: shell

    ListenAddress 192.168.0.1
    # password authentication is disabled for root
    PermitRootLogin without-password

consultar información del kernel sobre sokets.

.. code-block:: shell

    $ ss -plnt
    State       Recv-Q Send-Q   Local Address:Port     Peer Address:Port
    LISTEN      0      128                  *:80                  *:*
    LISTEN      0      128                  *:22                  *:*
    LISTEN      0      128          127.0.0.1:631                 *:*
    LISTEN      0      20           127.0.0.1:25                  *:*

Ver historia de connecciones ssh al servidor

.. code-block:: shell

    $ sudo zgrep sshd /var/log/auth.log* | grep rhost
    $ sudo zgrep sshd /var/log/auth.log* | grep Accepted

fail2ban
--------

.. code-block:: shell

    $ sudo apt-get update
    $ sudo apt-get install fail2ban

.. code-block:: shell

    $ sudo service fail2ban status
    ● fail2ban.service - LSB: Start/stop fail2ban
       Loaded: loaded (/etc/init.d/fail2ban)
       Active: active (running) since Mon 2018-07-23 10:22:54 EDT; 3 weeks 3 days ago
       CGroup: /system.slice/fail2ban.service
               └─1113 /usr/bin/python /usr/bin/fail2ban-server -b -s /var/run/fail2ban/fail2ban.sock -p /var/run/fail2ban/fail2ban.pid
    $ sudo fail2ban-client status
    Status
    |- Number of jail:  1
    `- Jail list:       ssh
    $ sudo fail2ban-client status ssh
    Status for the jail: ssh
    |- filter
    |  |- File list:    /var/log/auth.log
    |  |- Currently failed: 0
    |  `- Total failed: 16780
    `- action
       |- Currently banned: 0
       |  `- IP list:
       `- Total banned: 162

.. code-block:: shell

    $ cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local



Plone
=====

.. code-block:: shell

   $ sudo apt-get install build-essential libssl-dev libxml2-dev libxslt1-dev libbz2-dev libjpeg62-dev
   $ sudo apt-get install libreadline-dev wv poppler-utils
   $ sudo apt-get install git

Python
------

.. note::

   Si quieres usar el python del sistema necesitamos.

   .. code-block:: shell

      $ sudo apt-get install python-setuptools python-virtualenv python-dev


`buildout.python <https://github.com/collective/buildout.python>`_
------------------------------------------------------------------

Trying to install PIL for python2.4

.. code-block:: shell


    fatal error: freetype/fterrors.h: No such file or directory

The version of freetype is 2, I guess it's the problem.

.. code-block:: shell

    $ cd /usr/include
    $ ln -s freetype2 freetype

.. note::

    En Mac OS X necesitamos un ambiente virtual con :file:`zc.buildout-1.4.4` y :file:`setuptools-1.4.2`


Python from source
------------------

Se instala por default en  `/usr/local/bin`

.. code-block:: shell

    $ tar xfvz Python-2.7.13.tgz
    $ cd Python-2.7.13
    $ ./configure
    $ make
    $ make test
    $ sudo make install
    $ sudo /usr/local/bin/python2.7 -m ensurepip
    $ sudo pip uninstall setuptools
    $ sudo pip install virtualenv


Latex
-----

.. code-block:: shell

    $ sudo apt-get install texlive

For `500 Lines or Less <https://github.com/aosabook/500lines>`_ PDF

.. code-block:: shell

    $ sudo apt-get install texlive-latex-extra
    $ sudo apt-get install texlive-fonts-extra


.. note::

    En Mac OS X con MacTeX 2018 y Pandoc 2.2.1, actualizamos en :file:`build.py`


    .. code-block:: python

        def _pandoc_cmd(chapter_markdown):
            pandoc_path = 'pandoc'
            # tex/md because that's where the preprocessed markdowns end up
            temp = '{pandoc} -V chaptertoken={chaptertoken} -t latex --top-level-division=chapter -f markdown+mmd_title_block+tex_math_dollars+smart --template=tex/chaptertemplate.tex --no-highlight -o tex/{basename}.tex.1 tex/{md}'
            basename = getbasename(chapter_markdown)
            result = temp.format(pandoc=pandoc_path, basename=basename, md=chapter_markdown, chaptertoken='s:' + basename)
            return result


Random Passwords via Command Line
---------------------------------

.. code-block:: shell

    $ openssl rand -base64 6


Referencias
-----------

`HowTo: Add Jobs To cron Under Linux or UNIX? <https://www.cyberciti.biz/faq/how-do-i-add-jobs-to-cron-under-linux-or-unix-oses/>`_

`How To Protect SSH with fail2ban on Debian 7 <https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-debian-7>`_

`Installing Plone for the Training <https://training.plone.org/5/plone_training_config/instructions.html>`_

`How To Use ps, kill, and nice to Manage Processes in Linux <https://www.digitalocean.com/community/tutorials/how-to-use-ps-kill-and-nice-to-manage-processes-in-linux>`_

